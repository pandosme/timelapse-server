"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const lodash_1 = require("lodash");
const SCHEME_REGEXP = /(?:^|\,\s|\,)([A-Z][a-zA-Z0-9_]+)\s/gm;
const SPECIAL_SYMBOL_REGEXP = /\s|\,/gm;
exports.SCHEME_DIGEST = 'Digest';
class Header {
    static parse(header) {
        const schemes = (header.match(SCHEME_REGEXP) || []).map((scheme) => scheme.replace(SPECIAL_SYMBOL_REGEXP, ''));
        const contents = header.replace(SCHEME_REGEXP, '{scheme}').split('{scheme}').slice(1);
        return lodash_1.chain(schemes)
            .reduce((res, scheme, index) => [...res, { raw: contents[index], scheme }], [])
            .map((challenge) => {
            return challenge.scheme === exports.SCHEME_DIGEST
                ? Object.assign({}, challenge, Header.parseDigest(challenge.raw)) : Object.assign({}, challenge);
        })
            .value();
    }
    static generate(digest) {
        return `${exports.SCHEME_DIGEST} ` + lodash_1.reduce(digest, (acc, value, key) => {
            return (lodash_1.isUndefined(value))
                ? acc
                : [...acc, `${key}=${value}`];
        }, []).join(', ');
    }
    static parseDigest(content) {
        return content
            .replace(/\,\s/gm, ',')
            .split(',')
            .reduce((res, param) => {
            const pair = param.replace('=', '{{=}}').split('{{=}}');
            return Object.assign({}, res, { [lodash_1.first(pair) || 'unknown']: lodash_1.last(pair) || 'unknown' });
        }, {});
    }
}
exports.Header = Header;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaGVhZGVyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vc3JjL2xpYi9oZWFkZXIudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQSxtQ0FBK0Q7QUFFL0QsTUFBTSxhQUFhLEdBQUcsdUNBQXVDLENBQUM7QUFDOUQsTUFBTSxxQkFBcUIsR0FBRyxTQUFTLENBQUM7QUFDM0IsUUFBQSxhQUFhLEdBQUcsUUFBUSxDQUFDO0FBWXRDLE1BQWEsTUFBTTtJQUVWLE1BQU0sQ0FBQyxLQUFLLENBQUMsTUFBYztRQUNoQyxNQUFNLE9BQU8sR0FBRyxDQUFDLE1BQU0sQ0FBQyxLQUFLLENBQUMsYUFBYSxDQUFDLElBQUksRUFBRSxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsTUFBTSxFQUFFLEVBQUUsQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDLHFCQUFxQixFQUFFLEVBQUUsQ0FBQyxDQUFDLENBQUM7UUFDL0csTUFBTSxRQUFRLEdBQUcsTUFBTSxDQUFDLE9BQU8sQ0FBQyxhQUFhLEVBQUUsVUFBVSxDQUFDLENBQUMsS0FBSyxDQUFDLFVBQVUsQ0FBQyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUN0RixPQUFPLGNBQUssQ0FBQyxPQUFPLENBQUM7YUFDbEIsTUFBTSxDQUFDLENBQUMsR0FBK0IsRUFBRSxNQUFNLEVBQUUsS0FBSyxFQUFFLEVBQUUsQ0FBQyxDQUFDLEdBQUcsR0FBRyxFQUFFLEVBQUUsR0FBRyxFQUFFLFFBQVEsQ0FBQyxLQUFLLENBQUMsRUFBRSxNQUFNLEVBQUUsQ0FBQyxFQUFFLEVBQUUsQ0FBQzthQUMxRyxHQUFHLENBQUMsQ0FBQyxTQUFTLEVBQUUsRUFBRTtZQUNqQixPQUFPLFNBQVMsQ0FBQyxNQUFNLEtBQUsscUJBQWE7Z0JBQ3ZDLENBQUMsbUJBQUssU0FBUyxFQUFLLE1BQU0sQ0FBQyxXQUFXLENBQUMsU0FBUyxDQUFDLEdBQUcsQ0FBQyxFQUNyRCxDQUFDLG1CQUFLLFNBQVMsQ0FBQyxDQUFBO1FBQ3BCLENBQUMsQ0FBQzthQUNELEtBQUssRUFBRSxDQUFDO0lBQ2IsQ0FBQztJQUVNLE1BQU0sQ0FBQyxRQUFRLENBQUMsTUFBc0I7UUFDM0MsT0FBTyxHQUFHLHFCQUFhLEdBQUcsR0FBRyxlQUFNLENBQUMsTUFBTSxFQUFFLENBQUMsR0FBMEIsRUFBRSxLQUFrQyxFQUFFLEdBQVcsRUFBRSxFQUFFO1lBQzFILE9BQU8sQ0FBQyxvQkFBVyxDQUFDLEtBQUssQ0FBQyxDQUFDO2dCQUN6QixDQUFDLENBQUMsR0FBRztnQkFDTCxDQUFDLENBQUMsQ0FBQyxHQUFHLEdBQUcsRUFBRSxHQUFHLEdBQUcsSUFBSSxLQUFLLEVBQUUsQ0FBQyxDQUFDO1FBQ2xDLENBQUMsRUFBRSxFQUFFLENBQUMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7SUFDcEIsQ0FBQztJQUVTLE1BQU0sQ0FBQyxXQUFXLENBQUMsT0FBZTtRQUMxQyxPQUFPLE9BQU87YUFDWCxPQUFPLENBQUMsUUFBUSxFQUFFLEdBQUcsQ0FBQzthQUN0QixLQUFLLENBQUMsR0FBRyxDQUFDO2FBQ1YsTUFBTSxDQUFDLENBQUMsR0FBRyxFQUFFLEtBQUssRUFBRSxFQUFFO1lBQ3JCLE1BQU0sSUFBSSxHQUFHLEtBQUssQ0FBQyxPQUFPLENBQUMsR0FBRyxFQUFFLE9BQU8sQ0FBQyxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsQ0FBQztZQUN4RCx5QkFDSyxHQUFHLElBQ04sQ0FBQyxjQUFLLENBQUMsSUFBSSxDQUFDLElBQUksU0FBUyxDQUFDLEVBQUUsYUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLFNBQVMsSUFDbkQ7UUFDSixDQUFDLEVBQUUsRUFBRSxDQUFDLENBQUM7SUFDWCxDQUFDO0NBQ0Y7QUFuQ0Qsd0JBbUNDIn0=